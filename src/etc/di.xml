<?xml version="1.0"?>
<config
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <!-- *** -->
    <!-- API -->
    <!-- *** -->
    <preference for="\Praxigento\Downline\Api\Tree\Get\EntriesInterface"
            type="\Praxigento\Downline\Api\Tree\Get\Entries"/>
    <preference for="\Praxigento\Downline\Api\Tree\Get\UplineInterface"
            type="\Praxigento\Downline\Api\Tree\Get\Upline"/>

    <!-- **** -->
    <!-- Repo -->
    <!-- **** -->
    <preference for="\Praxigento\Downline\Repo\Agg\IAccount"
            type="\Praxigento\Downline\Repo\Agg\Def\Account"/>
    <preference for="Praxigento\Downline\Repo\Entity\IChange"
            type="Praxigento\Downline\Repo\Entity\Def\Change"/>
    <preference for="Praxigento\Downline\Repo\Entity\ICustomer"
            type="Praxigento\Downline\Repo\Entity\Def\Customer"/>
    <preference for="Praxigento\Downline\Repo\Entity\ISnap"
            type="Praxigento\Downline\Repo\Entity\Def\Snap"/>

    <!-- ******** -->
    <!-- Services -->
    <!-- ******** -->
    <preference for="Praxigento\Downline\Service\ICustomer"
            type="Praxigento\Downline\Service\Customer\Call"/>
    <preference for="Praxigento\Downline\Service\IMap"
            type="Praxigento\Downline\Service\Map\Call"/>
    <preference for="Praxigento\Downline\Service\ISnap"
            type="Praxigento\Downline\Service\Snap\Call"/>

    <!-- ***** -->
    <!-- Tools -->
    <!-- ***** -->
    <preference for="\Praxigento\Downline\Tool\IReferral"
            type="Praxigento\Downline\Tool\Def\Referral"/>
    <preference for="Praxigento\Downline\Tool\ITree"
            type="Praxigento\Downline\Tool\Def\Tree"/>

    <!-- ******* -->
    <!-- PLUGINS -->
    <!-- ******* -->
    <type name="\Magento\Customer\Model\Customer">
        <!-- define default group ID for referral customers -->
        <plugin name="praxigento_downline"
                type="\Praxigento\Downline\Plugin\Customer\Model\Customer"
                sortOrder="100" disabled="false"/>
    </type>

    <type name="\Magento\Customer\Model\GroupManagement">
        <!-- replace anonymous group for referrals -->
        <plugin name="praxigento_warehouse_plugin"
                type="\Praxigento\Downline\Plugin\Customer\Model\GroupManagement"
                sortOrder="100" disabled="false"/>
    </type>

    <type name="\Magento\Customer\Model\Session">
        <!-- replace anonymous group for referrals -->
        <plugin name="praxigento_warehouse_plugin"
                type="\Praxigento\Downline\Plugin\Customer\Model\Session"
                sortOrder="100" disabled="false"/>
    </type>

    <type name="\Magento\Framework\App\FrontControllerInterface">
        <!-- analyze referral codes in requests (plugin should be loaded before page cache plugins, see "sortOrder") -->
        <plugin name="praxigento_downline"
                type="\Praxigento\Downline\Plugin\Framework\App\FrontControllerPlugin"
                sortOrder="-100" disabled="false"/>
    </type>

    <type name="\Magento\Framework\View\Element\UiComponent\DataProvider\CollectionFactory">
        <!-- Add custom columns to the customer grid -->
        <plugin name="praxigento_downline"
                type="\Praxigento\Downline\Plugin\Framework\View\Element\UiComponent\DataProvider\CollectionFactory"
                sortOrder="100" disabled="false"/>
    </type>

</config>